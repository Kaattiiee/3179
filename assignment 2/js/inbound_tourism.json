{
	"$schema": "https://vega.github.io/schema/vega-lite/v5.json",
	"width": 1000,
	"height": 450,
	"title": {
		"text": "Inbound Tourists by Country of Residence (Mar 2024 - Mar 2025)",
		"fontSize": 16
	},
	"background": "rgb(247, 245, 245)",   
  	"config": {
    	"view": {
      		"fill": "rgb(247, 245, 245)",
      		"stroke": "transparent"
    	}
	},
	"projection": {"type": "equalEarth"},
	"data": {
	  "url": "https://kaattiiee.github.io/3179/assignment%202/datasets/in_country_residence.csv"
	},
	"params": [
	  {
		"name": "tourist_slider",
		"value": 0,
		"bind": {
		  "input": "range",
		  "min": 0,
		  "max": 800,
		  "step": 100,
		  "name": "Minimum number of tourists (in thousands): "
		}
	  }
	],
	"transform": [
	  {
		"calculate": "toNumber(replace(datum['number of tourists(000)'], ',', ''))",
		"as": "num_tourists"
	  },
	  {
		"calculate": "datum.num_tourists >= tourist_slider ? 1 : 0",
		"as": "show_country"
	  }
	],
	"layer": [
	  {
		"data": {
        "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/7_others/oceans.topojson",
        "format": {"type": "topojson", "feature": "oceans"}
      	},
      	"mark": {"type": "geoshape", "fill": "skyblue"}
      },

	  {
		"data": {
		  "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/WorldMapWithGraticules.topojson",
		  "format": {"type": "topojson", "feature": "ne_110m_admin_0_countries"}
		},
		"mark": {"type": "geoshape", "fill": "lightgray", "stroke": "white"}
	  },
	  {
		"data": {
		  "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/2_symbol_map/js/WorldMapWithGraticules.topojson",
		  "format": {"type": "topojson", "feature": "ne_110m_graticules_30"}
		},
		"mark": {"type": "geoshape", "fill": null, "stroke": "lightgray"}
	  },
	  {
		"mark": {"type": "circle"},
		"encoding": {
		  "longitude": {"field": "longitude", "type": "quantitative"},
		  "latitude": {"field": "latitude", "type": "quantitative"},
		  "size": {"field": "total_spend($M)", "type": "quantitative", "title": "Total Spend ($M)"},
		  "color": {"field": "num_tourists", "type": "quantitative", "title": "Number of Tourists (000)", "scale": {"scheme": "reds"}},
		  "opacity": {
			"condition": {"value": 1, "test": "datum.show_country == 1"},
			"value": 0.2
		  },
		  "tooltip": [
			{"field": "country", "type": "nominal", "title": "Country Name"},
			{"field": "num_tourists", "type": "quantitative", "title": "Number of Tourists (000)", "format": ".2f"},
			{"field": "total_spend($M)", "type": "quantitative", "title": "Total Spend ($M)", "format": ".2f"}
		  ]
		}
	  },
	  {
		"mark": {
		  "type": "text",
		  "align": "right",
		  "baseline": "middle",
		  "dx": -10,
		  "dy": -10,
		  "fontSize": 12,
		  "fontStyle": "bold",
		  "color": "black"
		},
		"transform": [
		  {
			"calculate": "toNumber(replace(datum['number of tourists(000)'], ',', ''))",
			"as": "num_tourists"
		  },
		  {
			"window": [{"op": "rank", "as": "ranking"}],
			"sort": [{"field": "num_tourists", "order": "descending"}]
		  },
		  {"filter": "datum.ranking == 1"},
		  {
			"calculate": "'Top Country: ' + datum['country'] + ' (' + format(datum.num_tourists, ',.2f') + 'k tourists)'",
			"as": "top_annotation"
		  }
		],
		"encoding": {
		  "longitude": {"field": "longitude", "type": "quantitative"},
		  "latitude": {"field": "latitude", "type": "quantitative"},
		  "text": {"field": "top_annotation"}
		}
	  }
	]
  }
  